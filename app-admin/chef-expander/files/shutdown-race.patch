From 87f2a2b569ccb167003ff51915e8f545b7dbabdd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Benedikt=20B=C3=B6hm?= <bb@xnull.de>
Date: Sat, 8 Jun 2013 22:28:27 +0200
Subject: [PATCH] hotfix restarting workers during shutdown race

---
 chef-expander/lib/chef/expander/cluster_supervisor.rb | 1 +
 1 file changed, 1 insertion(+)

diff --git a/chef-expander/lib/chef/expander/cluster_supervisor.rb b/chef-expander/lib/chef/expander/cluster_supervisor.rb
index 56d6e70..7a2a5ca 100644
--- a/chef-expander/lib/chef/expander/cluster_supervisor.rb
+++ b/chef-expander/lib/chef/expander/cluster_supervisor.rb
@@ -84,6 +84,7 @@ module Chef
       end
 
       def start_worker(index)
+        return unless @running
         log.info { "Starting cluster worker #{index}" }
         worker_params = {:index => index}
         child_pid = fork do
-- 
1.8.1.5

