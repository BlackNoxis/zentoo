From 93f9360b4b1d6234b1beef06dda36ae01ee17a0f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Benedikt=20B=C3=B6hm?= <bb@xnull.de>
Date: Tue, 3 Jan 2012 09:50:46 +0100
Subject: [PATCH] mongodb 2.0 compatibility

---
 modules/mongodbbackend/Makefile.am       |    2 +-
 modules/mongodbbackend/mongodbbackend.hh |    8 ++++++--
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/modules/mongodbbackend/Makefile.am b/modules/mongodbbackend/Makefile.am
index e3b4eb7..c37f734 100644
--- a/modules/mongodbbackend/Makefile.am
+++ b/modules/mongodbbackend/Makefile.am
@@ -1,4 +1,4 @@
-AM_CPPFLAGS=@THREADFLAGS@
+AM_CPPFLAGS=@THREADFLAGS@ -fno-strict-aliasing
 EXTRA_DIST=OBJECTFILES OBJECTLIBS 
 
 INCLUDES=-I/opt/mongo/include/mongo/
diff --git a/modules/mongodbbackend/mongodbbackend.hh b/modules/mongodbbackend/mongodbbackend.hh
index 816128f..48c093b 100644
--- a/modules/mongodbbackend/mongodbbackend.hh
+++ b/modules/mongodbbackend/mongodbbackend.hh
@@ -1,14 +1,18 @@
 #ifndef MONGODB_HH
 #define MONGODB_HH
 
+// include this one first, so that L is not clobbered by PDNS' logging macro
+#include "client/dbclient.h"
+
 #include "pdns/dnsbackend.hh"
 
 #undef VERSION
+#include <memory>
+using std::auto_ptr;
+
 #include <string>
 using std::string;
 
-#include "client/dbclient.h"
-
 class MONGODBException {
 public:
   MONGODBException(const string &ex) : what(ex){}
-- 
1.7.4.5

